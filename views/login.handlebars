<script src="/js/jquery.validate.min.js"></script>
<div>
	<div class="ui middle aligned center aligned grid">
		<div class="column">
			<h2 class="ui teal image header">
					Login to your account
			</h2>
			<form id="signup_form" action="/login" class="ui large form" method="POST" enctype="multipart/form-data">
				<div class="ui stacked segment">
					<div class="field">
						<div class="ui left icon input">
							<i class="user icon"></i>
							<input type="text" id="username" name="username" placeholder="Username or E-mail address">
						</div>
					</div>
					<div class="field">
						<div class="ui left icon input">
							<i class="lock icon"></i>
							<input id="password" name="password" placeholder="Password" type="password">
						</div>
					</div>
					<input type="submit" class="ui fluid large teal submit button" value="Login" />
				</div>

				<div class="ui error message"></div>

			</form>

			<div class="ui message">
				New to us? <a href="#">Sign Up</a>
			</div>
		</div>
	</div>
	<script>
		$("#signup_form").validate({
			rules: {
				username: {
					required: true
				},
				password: {
					required: true
				}
			},
			messages: {
				password: {
					required: "Please enter a password"
				},
				username: {
					required: "Please select a username"
				}
			},
			submitHandler: function (form) {
				$.post($(form).attr('action'), $(form).serialize() + "&from=jquery", function (data) {
					var jData;
					if(typeof data === "object") jData = data;
					else jData = JSON.parse(data);
					if (jData['success'] === true) {
						window.location = jData['redirect'];
					} else if (jData['success'] === false) {
						var miscError = "";
						for (var index in jData['error']) {
							if (jData['error'].hasOwnProperty(index)) {
								switch (index) {
									case 'password':
										var password = $('#password');
										password.siblings().remove();
										password.after('<label for="password" class="error" id="password-error"></label>');
										$('#password-error').text(jData['error'][index]);
										password.addClass('error');
										break;
									case 'username':
										var username = $("#username");
										username.siblings().remove();
										username.after('<label for="username" class="error" id="username-error"></label>');
										$('#username-error').text(jData['error'][index]);
										username.addClass('error');
										break;
									default:
										miscError+=jData['error'][index]+".\n";
								}
							}
						}
						$("#signup_form").parent().prepend('<div class="notice errorbox"><p></p></div>');
						$(`#signup_form`).parent().find("div.notice.errorbox p").text(miscError);
					}
				});
			}
		});
	</script>
</div>